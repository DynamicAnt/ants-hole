    server {
        listen       80;
        server_name  www.abiz.com abiz.com;


	set $_abiz_session "";
	if ( $http_cookie ~* "_abiz_session=(\S+)(;.*|$)")
	{
        	set $_abiz_session $1;
	}

    	if ($uri ~ /demands/list-abizservicezhang_.*){
                return 403;
        }

        access_log  logs/abiz.access.log  main_abiz_cookie;
        error_log  logs/abiz.error.log  notice;
	rewrite ^/caigourj$  http://www.abiz.com/caigourj/ permanent;
	rewrite ^/subjects/client$ http://download.abiz.com/cgzl/ permanent; 
        rewrite ^/subjects/caigourj.html$ http://www.abiz.com/ permanent;
        rewrite ^/subjects/caigourj.htm$ http://www.abiz.com/ permanent;
        rewrite ^/subjects/caigourj$ http://www.abiz.com/ permanent;
	rewrite ^/subjects/caigourj/(.*)$	http://www.abiz.com/html/404.html permanent;
	rewrite ^/info/help/index.htm$ http://www.abiz.com/info/service/index.htm permanent;
	rewrite ^/caigouzx/$  http://www.abiz.com/caigoutj permanent;
	rewrite ^/caigourj/video.html$  http://www.abiz.com/caigourj/  redirect;
	rewrite ^/gongyepin/$  http://mro.abiz.com permanent;
	#rewrite ^/jeeadmin/jeecms/index.do  http://www.abiz.com/info/jeeadmin/jeecms/index.do permanent;
	rewrite ^/jeeadmin/(.*)   http://www.abiz.com/info/jeeadmin/$1 permanent;


       location ^~ /client_install/ {
                root /home/mic/ABIZ/web/;
                expires 30d;
                }


       location ^~ /2017/ {
                root /home/mic/ABIZ/web;
                index index.html;
                }


        location ~  ^/app_update/ {
                root /home/mic/ABIZ/web/;
                }


       location ^~ /caucho-status {
                return  403;
                }
       location ^~ /info/caucho-status {
                return  403;
                }


       location /to_newcn/{
               proxy_pass http://MIC_CN_2015www/;
               proxy_set_header Host "cn.made-in-china.com";
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        location /to_oldcn/ {
                proxy_pass http://MIC_CN/;
               proxy_set_header Host "cn.made-in-china.com";
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                }

	
       location /focusourcing/index.htm {
        proxy_pass http://old.mro.abiz.com/focusourcing/index.htm;
        proxy_redirect off;
	proxy_set_header Host "oldmro.abiz.com";
        proxy_set_header X-Real-IP $remote_addr;
        }        
                 

        location /focusourcing/ {
        proxy_pass http://old.mro.abiz.com/focusourcing/;
        proxy_redirect off;
	proxy_set_header Host "oldmro.abiz.com";
        proxy_set_header X-Real-IP $remote_addr;
        }



	location ^~ /gongyepin/ {
        	proxy_pass http://MIC_CN_Channel;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }       
	location ^~ /channel/ {
        	proxy_pass http://MIC_CN_Channel/channel/;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }
	location ^~ /notice/ {
       		proxy_pass http://MIC_CN_Channel/abiz/notice/;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }    

	location ^~ /gongyepin/jixie/ {
        	proxy_pass http://MIC_CN_Channel/gongyepin/jixie.html;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }   

	location ^~ /gongyepin/wujin/ {
        	proxy_pass http://MIC_CN_Channel/gongyepin/wujin.html;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }   

	location ^~ /gongyepin/yiqi/ {
        	proxy_pass http://MIC_CN_Channel/gongyepin/yiqi.html;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }   

	location ^~ /gongyepin/shebei/ {
        	proxy_pass http://MIC_CN_Channel/gongyepin/shebei.html;
                proxy_next_upstream error timeout http_503  http_504 http_404 http_502;
                error_page  504 502 = @MIC_CN_Channel_BACKUP;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
        }  

        location ^~ /pb {
                if ( $request_uri ~ /pb-xj-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                if ( $request_uri ~ /pb-zm-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                if ( $request_uri ~ /pb-jj-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                if ( $request_uri ~ /pb-zb-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                if ( $request_uri ~ /pb-zbi-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                if ( $request_uri ~ /pb-static-([a-zA-Z0-9\-]+)/(.*) )  {
                   set $host_usename  $1;
                }
                set $hosta "${host_usename}.abiz-beta.com";
                proxy_pass http://ABIZ_PRE_001;
                proxy_set_header fromdata "www.abiz.com";
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
                proxy_set_header Host $hosta;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;

         }      
                
      location ^~ /showroom-abiz/ {
                if ( $request_uri ~ /showroom-abiz/([a-zA-Z0-9\-]+)-([-a-zA-Z0-9-]+).html )  {
                         set $host_usename  $1;
                      } 
                if ( $request_uri ~ /showroom-abiz/([a-zA-Z0-9\-]+)-([-a-zA-Z0-9-]+)-(.*).html )  {
                         set $host_usename  $1;
                      }
                set $hosta "${host_usename}.abiz-beta.com";
                proxy_pass http://ABIZ_PRE_001;
                proxy_set_header fromdata "www.abiz.com";
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
                proxy_set_header Host $hosta;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;

         }      

        location /img {
                proxy_pass http://ABIZ_AEPS_IMG/;
        }  


        location /info/jeeadmin/jeecms/ {
                allow 58.240.26.0/24;
                allow 218.104.82.0/24;
                allow 218.104.118.0/24;
                allow 202.102.75.0/24;
                allow 202.102.95.0/24;
                allow 192.168.1.0/24;
		allow 58.240.26.134;
		allow 221.226.184.164; 
                deny all;
                proxy_next_upstream error timeout http_503 http_500 http_502 http_504 http_404;
                proxy_pass  http://abiz-cms/jeeadmin/jeecms/;
                }

        location  /info/monitor.html {
                root /home/mic/ABIZ/web/;
                }


        location /info/ {
                proxy_next_upstream error timeout http_503 http_500  http_504 http_404;
                proxy_pass  http://abiz-cms/;
                }


        location / {
        	if ($http_user_agent ~* "qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot|bingbot")
        {
                proxy_pass http://abiz-web-spider;
                access_log  logs/abiz.access.log  main_abiz_cookie;
        }

                rewrite ^/$ /html/index.html break;
                proxy_next_upstream error timeout http_503  http_502 http_504 http_404 ;
                proxy_pass http://abiz-web;
		error_page  504 503 502  = @abiz_web_backup;
                proxy_redirect off;
                proxy_store off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                }

	location @abiz_web_backup      {
                proxy_next_upstream error timeout http_503 http_502 http_504;
                proxy_pass http://abiz-web-BACKUP;
                break;
        }

}


   server {
        listen       443;
        server_name  www.abiz.com abiz.com;

set $_abiz_session "";
if ( $http_cookie ~* "_abiz_session=(\S+)(;.*|$)")
{
        set $_abiz_session $1;
}


        access_log  logs/abiz.access.log  main_abiz_cookie;
        error_log  logs/abiz.error.log  notice;

        ssl                  on;
        ssl_certificate      /opt/xyz/nginx/conf/abiz_ssl_cert/server.crt;
        ssl_certificate_key  /opt/xyz/nginx/conf/abiz_ssl_cert/server.key;
        ssl_session_timeout  30m;
        ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers  ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:!RC4;
        ssl_prefer_server_ciphers   on;

       location ^~ /caucho-status {
                return  403;
                }
        location ^~ /tm/condition_search/ {
                allow 192.168.69.0/24;
                allow 192.168.0.0/16;
                deny all;
                }

      location /to_pay/ {
                proxy_pass http://ABIZ_cfpay/to_pay/;
                }
        location /payresources/ {
                proxy_pass http://ABIZ_cfpay/;
                }

        location /to_vo/ {
                proxy_pass http://MIC_CN_VO/;
		error_page  502 503 504 = @mic_cn_vo_backup;
                }
        location /to_oldcn/ {
                proxy_pass http://MIC_CN/;
               proxy_set_header Host "cn.made-in-china.com";
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                }
	location @mic_cn_vo_backup {
		proxy_pass http://MIC_CN_VO_BACKUP;
		}

	

        location / {
                proxy_pass https://abiz-web-ssl;
		error_page  504 503 502  = @abiz_web_ssl_backup;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                }
	location @abiz_web_ssl_backup     {
                proxy_pass https://abiz-web-ssl-BACKUP;
        }


}
